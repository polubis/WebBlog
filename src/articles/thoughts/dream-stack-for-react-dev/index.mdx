---
cdate: 2023-02-28
mdate: 2023-04-21
tbcdate: 2023-06-26
authorId: polubis
treviewerId: kwozniak
lreviewerId: kreszko
tags: architecture,project setup,patterns,quality gates
stack: typescript,react,rxjs,nx,cypress,jest,storybook,chromatic,redux,styled-components,next
description: It will be a longer article about project setup. Prepare a huge mug of coffee before you start reading.
readTime: 15
title: Dream stack for React dev
---

<Prelude>
  <M>Developers should work on functionalities. Did I say something weird?</M>
  <M>
    Many of you may disagree. What about creating a project? What about
    connecting <B>eslint</B>, <B>prettier</B>? What about preparing a test
    environment for <B>unit</B> and <B>e2e</B> tests? Seems like a lot of work.
    Honestly, it may be...
  </M>
  <M>
    However, today you'll see how you can do it easier/better/faster/stronger
    üéß.
  </M>
  <Hint hasBg>
    Here is a{" "}
    <A outside href="https://github.com/polubis/Dream-stack-for-React-dev/">
      final result
    </A>
    . Don't be afraid, just use it :0.
  </Hint>
</Prelude>

<Section>
  <XL>1. Monorepo</XL>
  <M>
    We'll divide our solution into <B>applications</B> and <B>libraries</B>. All
    of these will be stored in a single repository with the same configuration
    for linting, formatting, TypeScript, jest, cypress, storybook, ...etc.
  </M>
  <M>
    Thanks to this you will have the opportunity to run the applications
    separately or together. This is what you can achieve with <B>monorepo</B>.
    In simple words, it's a way of storing and managing a solution, which
    involves keeping the code in a single repository and dividing it into
    packages and applications accordingly.
  </M>
</Section>

<Section>
  <XL>2. Monorepo with nx</XL>
  <M>
    It's mainly a <B>CLI</B> and <B>patterns</B> that helps you to create and
    manage monorepo. Below is a list of cool things you will get with this
    technology:
  </M>
  <List items="apps and libs generation via CLI,organized structure,option to configure stuff like storybook via one command,dependency preview via graph,same configs for everything,configuration of the TypeScript,option to choose way of styling your components,routing configuration,bundler configuration, unit and e2e tests configuration, and many more..." />
</Section>

<Section>
  <XL>3. What will we create?</XL>
  <M>
    We are going to make a solution that will allow you to manage your blog and
    display the created articles/courses. So let's describe the components we'll
    create:
  </M>
  <List items="application for presenting the blog content and homepage,a blog management application,library for communicating with the API,utilities library,a library with components" />
  <M>
    Each component will be independent. It will reduce the risk of conflicts.
    Libs will be consumed by apps.
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/graph.png"
    description="Building blocks"
  />
  <Hint hasBg>
    Check out{" "}
    <A
      outside
      href="/articles/architecture/modular-architecture-for-medium-frontend-apps/"
    >
      this article
    </A>{" "}
    if you are interested in architecture.
  </Hint>
</Section>

<Section>
  <XL>4. Initialization of the project</XL>
  <M>
    First, install this script, which will start the <B>nx repository</B>:
  </M>
  <Hint hasBg>npm i -g create-nx-workspace@latest --legacy-peer-deps</Hint>
  <M>Later you need to type: </M>
  <Hint hasBg>npx create-nx-workspace@latest</Hint>
  <M>
    The CLI will ask you the following questions sequentially. You can find
    description of the options in{" "}
    <A outside href="https://nx.dev/getting-started/intro/">
      nx documentation
    </A>
    . Let's focus on creating our dream project.
  </M>
  <M>Answer the questions the same way I did.</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/questions.jpg"
    description="Questions and answers"
  />
  <M>The file and folder structure generated by nx should look like this:</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/folders-and-files.jpg"
    description="Generated content for blog application"
  />
  <M>
    If you look at it you will see that by default you have <B>TypeScript</B>,{" "}
    <B>prettier</B> and <B>eslint</B> configured. In addition, tests in{" "}
    <B>jest</B> have been configured and e2e in <B>cypress</B>.
  </M>
  <M>
    We already have a project and app in <B>Next.js</B>. Now it's time for the{" "}
    <B>single page application in React</B>.
  </M>
  <Hint hasBg>cd .\system\</Hint>
  <Hint hasBg>npx nx g @nrwl/react:application blog-creator</Hint>
  <M>
    The tool may ask you to install additional dependencies, which it uses to
    generate folders and files. Confirm it. After that, you will see similar
    questions as before. Answer them the same way I did:
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/react-questions.jpg"
    description="React app done"
  />
  <M>
    We have the apps! After a while you'll see two new folders in the{" "}
    <B>apps</B> directory.
  </M>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/25d239e6698c6d862afbff6fa481e784ca1b1a5e/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>5. Creating libraries</XL>
  <M>
    The idea is the same, only the questions and your answers differ. It's
    beautiful ‚ù§Ô∏è. Type the command:
  </M>
  <Hint hasBg>npx nx g @nrwl/react:lib figa-ui</Hint>
  <M>
    I named my components library after my beloved cat - <B>Figa</B>. You can
    name it after a turtle (or whatever pet you have at home). These are my
    answers:
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/ui-lib-setup.jpg"
    description="You have figa-ui installed :D"
  />
  <M>
    Now it's time to do the two simplest things. We need to create two{" "}
    <B>TypeScript</B> libraries. Type the following two commands:
  </M>
  <Hint hasBg>npx nx generate @nrwl/js:lib utils</Hint>
  <Hint hasBg>npx nx generate @nrwl/js:lib blog-api</Hint>
  <M>In both cases, choose the same answers:</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/pure-ts-lib-answers.jpg"
    description="TypeScript libs are cool"
  />
  <M>We have what we wanted, so let's move on.</M>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/5021144480bb788155a6cee17699a62ec5b5a74d/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>6. Adding storybook to UI library</XL>
  <M>
    <B>Storybook</B> will be needed for our components library. <B>Nx</B> allows
    per scope configuration or global one. We need scoped. So let's enter some
    commands:
  </M>
  <Hint hasBg>npm i --save @nrwl/storybook --legacy-peer-deps</Hint>
  <Hint hasBg>
    npx nx g @nrwl/storybook:configuration figa-ui
    --uiFramework=@storybook/react
  </Hint>
  <M>As usual there will be questions, answer as I did:</M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/storybook-answers.jpg"
    description="Storybook ready!"
  />
  <M>
    Now you can start the storybook process and play with it via this command:
  </M>
  <Hint hasBg>npx nx run figa-ui:storybook</Hint>
  <M>
    After a while, the <B>storybook window</B> will launch with the message that
    you don't have any story yet. We'll add the <B>Bell.tsx</B> and{" "}
    <B>Bell.stories.tsx</B> component to see if everything works as it should.
  </M>
  <Img
    src="/assets/dream-stack-for-react-dev/storybook-works.jpg"
    description="It works!"
  />
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/2bcf4873c2592b032015a24f3485c314230b6118/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>7. Running the applications</XL>
  <M>
    Now it begins :D. You can run all applications, one of them, or just the
    storybook. It depends what kind of feature you are already working on. To
    run single app type:
  </M>
  <Hint hasBg>npx nx serve blog</Hint>
  <M>You can run all apps via: </M>
  <Hint hasBg>
    npx nx run-many --parallel --target=serve --projects=blog,blog-creator
  </Hint>
  <M>or</M>
  <Hint hasBg>npx nx run-many --target=serve --all</Hint>
  <M>
    You can get an error about same port usage attempt. To fix it you need to
    visit <B>project.json</B> files and add port number. For each application
    add different one. After that type:
  </M>
  <Hint hasBg>npx nx run-many --target=serve --all</Hint>
  <M>
    and all applications will be run on different ports, in my case <B>3001</B>{" "}
    and <B>3002</B>. Looks cool? Yea!
  </M>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/3cd43866db3fe6c780dabb322bba7ba9ff5ac856/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>8. Using libraries</XL>
  <M>
    Take a look at this. Do you want to use a components library in two
    applications? Forget about <B>npm install</B>. All you need is a simple{" "}
    <B>import</B> statement.
  </M>
  <Snippet
    linesCount={7}
    src="/snippets/dream-stack-for-react-dev/how-to-import.tsx"
    description="The power of monorepo and nx"
  />
  <M>Who cares about configuring aliases for webpack? Certainly not you :D</M>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/eb157141da07fc66219ef3bbfa76f5784f7062df/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>9. Adding custom fonts</XL>
  <M>
    We need to download the fonts. <B>Lexend</B> variant will be suitable for us
    so let's take it from{" "}
    <A href="https://fonts.google.com/specimen/Lexend?query=Lexend" outside>
      Google Fonts
    </A>{" "}
    in the following sizes (300, 400, 500, 700). Immediately after that, we need
    to place the files in the appropriate directory - our <B>figa-ui</B>{" "}
    library.
  </M>
  <M>
    We are using <B>styled-components</B> so there is a need to create global
    styles, in which we'll declare our setup for fonts.
  </M>
  <Snippet
    linesCount={31}
    src="/snippets/dream-stack-for-react-dev/global-style.ts"
    description="Almost, but not yet"
  />
  <M>
    The current setup doesn't work yet. We need to add minor changes in the{" "}
    <B>preview.js</B> file and its extension must be changed to <B>.tsx</B>.
  </M>
  <Snippet
    linesCount={18}
    src="/snippets/dream-stack-for-react-dev/preview.tsx"
  />
  <M>
    In the <B>ts.config</B> file, we need to add <B>preview.tsx</B> to{" "}
    <B>include</B> array. Errors will be displayed if we skip that.
  </M>
  <Snippet>{`  "include": [
    {/* ...Other files */}
    "preview.tsx"
  ]`}</Snippet>
  <M>
    Well, how to test it? We need a component. Below is a partial implementation
    of <B>Font</B> component and usage in various places.
  </M>
  <Snippet
    linesCount={94}
    description="Partial implementation and usage"
    src="/snippets/dream-stack-for-react-dev/Font.tsx"
  />
  <M>
    At this stage, the fonts should look the same in the storybook, in the SPA
    application in React, and in the Next.js application.
  </M>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/9e7c0a7e54913bf4522c0a29c78e5b6d41fc8e8b/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>10. Adding husky</XL>
  <M>
    Husky is a library that allows you to run a scripts before a specific{" "}
    <B>git hook</B>. It is usually used to check code consistency, run tests and
    format code before commit. Let's install it via command{" "}
    <B>npm i --save-dev husky</B>.
  </M>
  <Hint hasBg>
    On{" "}
    <A href="https://git-scm.com/docs/githooks" outside>
      this page
    </A>{" "}
    you have a list of all hooks.
  </Hint>
  <M>
    Before each commit we need to format code with <B>prettier</B> and perform
    check with <B>eslint</B>. Fortunately for us, nx provides the configuration
    of both by default so the only thing left is the husky setup. To do this, we
    need to define an aliases for the scripts in <B>package.json</B>.
  </M>
  <Snippet>
    {`
"scripts": {
   "prepare": "cd .. && husky install system/.husky", // Changes folder and configures husky.
   "lint:fixAll": "npx nx run-many --target=lint --all --fix", // Runs linter and fixes if possible.
   "format:fixAll": "prettier --write \"./**/*.{js,ts,tsx}\"" // Runs prettier and formats if possible.
}
`}
  </Snippet>
  <M>
    Now every developer must run the <B>prepare</B> command after downloading
    the repository. Without that, husky will not work. After launching, you
    should see the <B>.husky directory</B> and the <B>pre-commit</B> file that
    needs to be changed.
  </M>
  <Img
    border
    src="/assets/dream-stack-for-react-dev/husky-created.jpg"
    description="Husky ready"
  />
  <M>
    The last change is to define the scripts that will be executed before the
    commit.
  </M>
  <Snippet>
    {`
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
cd system 
echo "Runnig linting and fix..."
npm run lint:fixAll
npm run format:fixAll
`}
  </Snippet>
  <M>
    Now every time when someone tries to do a commit then the scripts will be
    executed. If you want to skip the husky because you're just checking
    something, then use the <B>git commit -m "I'm just checking" --no-verify</B>.
  </M>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/6821d08d99e8642ab74835fee34fc421a4472d0d/"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>11. Adding themes</XL>
  <M>
    We want to give users the ability to set everything in the application
    according to their preferences. This would be useful for creating predefined
    themes or to debug interface behavior by developers/designers.
  </M>
  <M>
    It may seem like overkill, but admit that it's a pretty cool feature and not
    difficult to implement. You just have to stick to the specific guidelines
    that we're about to establish. Let's start by defining the{" "}
    <B>design tokens</B> and the <B>shape of theme</B>.
  </M>
  <M>
    Design tokens? These are nothing more than rigidly fixed values that our
    design system will use. It can be background color, font color, border
    rounding, font size and others... To simplify, these are nothing more than
    unique variables to which we assign the settings of our design system.
  </M>
  <List items="background.color='#f0f0f0',font.color='#000000',boxes.radius100='4px',font.size100='16px'" />
  <Snippet
    linesCount={25}
    src="/snippets/dream-stack-for-react-dev/design-tokens.ts"
  />
  <Hint hasBg>
    Note the quite "strange" shape of the tokens object. This manner is taken
    from <B>Material design</B> to which I refer you in this{" "}
    <A href="https://m3.material.io/foundations/design-tokens/overview" outside>
      link
    </A>
    .
  </Hint>
  <M>
    That themes should allow us to describe each component in our UI library, so
    we need to make sure that the values are taken from the theme, which the
    user is using.
  </M>
  <Snippet
    linesCount={26}
    src="/snippets/dream-stack-for-react-dev/theme-object.ts"
  />
  <M>
    When you add a new component, remember that all settings should be added to
    the themes, and if you use a new font size, color or anything else, you need
    to include it in the design tokens. Thanks to this you will get a very
    scalable components library. Now it's time for real work. Let's use{" "}
    <B>Context API</B> to provide logic for themes management.
  </M>
  <Snippet
    linesCount={50}
    src="/snippets/dream-stack-for-react-dev/provider.tsx"
    description="We're injecting themes and an API to change them"
  />
  <M>
    Done! All that's left is to use the theme in the styles and you can enjoy
    the ability to set up the UI in any way you want. Now with every next
    component you just need to use this approach.
  </M>
  <Snippet linesCount={5} src="/snippets/dream-stack-for-react-dev/css.ts" />
  <M>
    Let's assume that you want to use a component, and later you want to change
    theme. All you need to do is to wrap the whole application with the provider
    and import the dedicated component.
  </M>
  <Snippet
    linesCount={8}
    src="/snippets/dream-stack-for-react-dev/usage-in-all-places.tsx"
  />
  <Img border src="/assets/dream-stack-for-react-dev/themes.gif" />
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/ff48962e3899deddabf6fde82de723d3b98afe69"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>12. Sharing fonts between libs and apps</XL>
  <M>
    If you run the application or storybook and you don't have <B>"Lexend"</B>{" "}
    fonts installed, then get ready for the error in the browser console. We
    added the font face and font files, but did we think to move them to the
    public directories for the application or indicate for the storybook where
    these fonts are? It seems that no...
  </M>
  <M>
    The case for the storybook is easy. Just indicate the place from where the
    storybook should copy our assets and it will be done automatically during
    build. I moved the font files to the very top of the file and folder
    structure, just for convenience when importing. Next, I changed the
    configuration in the <B>main.js</B> file.
  </M>
  <Snippet>{`staticDirs: [{ from: '../../../assets', to: '/' }]`}</Snippet>
  <M>
    I corrected the import in font face to be shorter. The assets directory is
    redundant. Immediately after that, the fonts in the storybook updated their
    look and started to look like a real <B>"Lexend"</B>.
  </M>
  <Snippet>{`src: url('/fonts/LexendBold.ttf') format('truetype');`}</Snippet>
  <M>
    Now the applications. Here is a little more work. We need to use the webpack
    plugin to copy the contents of one folder to another. We'll do this for both
    applications in Next.js and in pure React.
  </M>
  <Snippet
    description="React SPA fonts copied!"
    linesCount={26}
    src="https://raw.githubusercontent.com/polubis/Dream-stack-for-React-dev/0ab6b3c21eecbe7d6446979c3bc1035adfe90c2f/system/apps/blog-creator/webpack.config.js"
  />
  <Snippet
    linesCount={39}
    src="https://raw.githubusercontent.com/polubis/Dream-stack-for-React-dev/0ab6b3c21eecbe7d6446979c3bc1035adfe90c2f/system/apps/blog/next.config.js"
    description="Next.js fonts copied!"
  />
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/0ab6b3c21eecbe7d6446979c3bc1035adfe90c2f"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Section>
  <XL>13. Fixing a strange error in styled-components</XL>
  <M>
    If you launch the console in the Next.js application, you will see an error
    indicating that the generated values for the <B>className</B> property, are
    different on the server and on the client. To fix it we need to add this to{" "}
    <B>next.config.js</B>.
  </M>
  <Snippet>
    {`compiler: {
  styledComponents: true // Next.js sets up the Babel plugin for styled-components.
}`}
  </Snippet>
  <Hint hasBg>
    In this{" "}
    <A
      outside
      href="https://github.com/polubis/Dream-stack-for-React-dev/commit/1d3b87e7d617d729e0d3c6fceed849072fe3c553"
    >
      commit
    </A>{" "}
    you have the full changes.
  </Hint>
</Section>

<Example>
  <M>
    <A href="https://github.com/polubis/Dream-stack-for-React-dev/" outside>
      Repository
    </A>{" "}
    to play with.
  </M>
</Example>

<Summary>
  <M>
    We went through the wonderful tool together. I recommend playing with it. We
    have described only a part of the possibilities.
  </M>
  <M>
    There is still place to add many more things. However, I think that it is
    better to add a little less than more. The repository we have implemented
    will be constantly improved so we recommend to taking a look at our{" "}
    <B>Github</B> from time to time.
  </M>
  <M>
    If you enjoyed it, be sure to visit us on{" "}
    <A href="https://www.linkedin.com/in/adrian-po%C5%82ubi%C5%84ski-281ab2172/" outside>
      Linkedin
    </A>{" "}
    where we regularly upload content from programming.
  </M>
</Summary>
